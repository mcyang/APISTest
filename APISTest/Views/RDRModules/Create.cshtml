@*@model APISTest.Models.RDRModule*@
@model APISTest.ViewModels.RDRModuleViewModel

@{
    ViewBag.Title = "Create";
}
<script src="~/Scripts/jquery-1.10.2.min.js"></script>

<ol class="breadcrumb">
    <li><a href="#">MKT管理</a></li>
    <li><a href="#">RDR維護</a></li>
    <li><a href="#">新增RDR表單</a></li>
    <li class="active">新增機種資料</li>
</ol>
@using (Html.BeginForm()) 
{
    @Html.AntiForgeryToken()
    
    <div class="form-horizontal">
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        @Html.HiddenFor(m => m.ParentID)
        @Html.HiddenFor(m => m.MainCode)
        @Html.HiddenFor(m => m.StartYear)
        @Html.HiddenFor(m => m.EndYear)

        @*<div class="form-group">
            @Html.LabelFor(model => model.ParentID, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.ParentID, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.ParentID, "", new { @class = "text-danger" })
            </div>
        </div>*@

        <div class="form-group">
            @Html.Label("RDR#", htmlAttributes: new { @class = "control-label col-md-2" })
            @*@Html.LabelFor(model => model.RDRNumber, htmlAttributes: new { @class = "control-label col-md-2" })*@
            <div class="col-md-5">
                <span style="color:red">系統自動編號</span>
                @*@Html.EditorFor(model => model.RDRNumber, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.RDRNumber, "", new { @class = "text-danger" })*@
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.ModuleName, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-5">
                @Html.EditorFor(model => model.ModuleName, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.ModuleName, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.Label("產品別", htmlAttributes: new { @class = "control-label col-md-2" })
            @*@Html.LabelFor(model => model.ProductGroupID, htmlAttributes: new { @class = "control-label col-md-2" })*@
            <div class="col-md-5">
                @* 下拉 *@
                @Html.DDL_ProductGroup("ProductGroupsList", 0)
                @*@Html.EditorFor(model => model.ProductGroupID, new { htmlAttributes = new { @class = "form-control" } })*@
                @Html.ValidationMessageFor(model => model.ProductGroupID, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.Label("交貨地", htmlAttributes: new { @class = "control-label col-md-2" })
            @*@Html.LabelFor(model => model.CustomerID, htmlAttributes: new { @class = "control-label col-md-2" })*@
            <div class="col-md-5">
                @*@Html.EditorFor(model => model.CustomerID, new { htmlAttributes = new { @class = "form-control" } })*@
                @* 下拉 *@
                @Html.DDL_Customers("CustomersList",1,0)
                @Html.ValidationMessageFor(model => model.CustomerID, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.Label("預估年產量", htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-5">
                <table class="table-bordered" id="mytable">
                    <tr>
                        <td class="col-xs-2">年度</td>
                        <td style="text-align:center">預估年產量</td>
                    </tr>
                    @for (int i = 0; i < (Model.EndYear - Model.StartYear + 1); i++)
                    {
                        int idx = Model.StartYear + i;
                        <tr>
                            <td style="text-align:center" class="myyears">@idx.ToString()</td>
                            <td style="text-align:center">
                                @Html.TextBox("Index_" + idx.ToString(), Model.Estimate, new { id= "Index_" + idx.ToString(), @class="myestimate" })
                            </td>
                        </tr>
                    }
                    @Html.HiddenFor(m => m.EstimateProduct)
                </table>
            </div>
        </div>

        <div class="form-group">
            @Html.Label("附件", htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-5">
                @* 上傳 *@
                <input type="file" id="file" name="file" />
                @Html.HiddenFor(model => model.Attachment)
                @*@Html.EditorFor(model => model.Attachment, new { htmlAttributes = new { @class = "form-control" } })*@
                @Html.ValidationMessageFor(model => model.Attachment, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.Label("備註", htmlAttributes: new { @class = "control-label col-md-2" })
            @*@Html.LabelFor(model => model.Remark, htmlAttributes: new { @class = "control-label col-md-2" })*@
            <div class="col-md-5">
                @Html.TextAreaFor(model => model.Remark, new { htmlAttributes = new { @class = "form-control" },rows=5, cols=70 })
                @Html.ValidationMessageFor(model => model.Remark, "", new { @class = "text-danger" })
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-1">
            @Html.ActionLink("返 回", "Index", null, new { @class = "btn btn-info" })
        </div>

        <div class="col-md-1">
            <div>
                <input type="submit" value="儲 存" class="btn btn-success" />
            </div>
        </div>
    </div>
}

<script type="text/javascript">

    //預估年產量字串陣列
    var list = [];

    ///預估年產量 textbox 內容變更事件
    $('.myestimate').change(function (e) {
        //Get ID & Value
        var ID = this.id;
        var year = this.id.substr(6, 4); //ex. Index_2016 => 2016
        var Value = $('#' + ID).val();

        //組合成字串
        var str = year + ":" + Value;
        list.push(str);
        $('#EstimateProduct').val(list);    //寫入Html.Hidden中
    });
    //$('.myestimate').each(function () {

    //    //get ID
    //    this.id.substr(6, 4);

    //    //get Value

    //    alert(this.val());
        
       
    //});

    $(function () {

        //var start = $('#StartYear').val();
        //var end = $('#EndYear').val();
        //var period = end - start + 1;

        //var list = [];
        //var yeartxt = $('.myestimate').find('.myyears').text();
        //for (var i = 0; i < yeartxt.length; i = i + (yeartxt.length / period)) {
        //    list.push(yeartxt.substr(i, 4)); //[2016,2017,2018,2019,2020]
        //}

        //var mylength = $("input[id^='Index_']").length;
        //for (var j = 0; j < mylength; j++) {
        //    var ids = $('.myestimate').find($("input[id^='Index_']")[j]).attr('id');

        //    $('#' + ids).change(function (e) {
        //        list[j] = list[j] + ":" + $('#' + ids).val();  //每年數量
        //        $('#AllEstimate').val(list);
        //        alert($('#AllEstimate').val());
        //    });
        //}

        //var ids = $('.myestimate').find($("input[id^='Index_']")[0]).attr('id');
        //$('#' + ids).change(function (e) {
        //    list[0] = list[0] + ":" + $('#' + ids).val();  //每年數量
        //    $('#AllEstimate').val(list);
        //    alert($('#AllEstimate').val());
        //});

        //var idss = $('.myestimate').find($("input[id^='Index_']")[1]).attr('id');
        //$('#' + idss).change(function (e) {
        //    list[1] = list[1] + ":" + $('#' + idss).val();  //每年數量
        //    $('#AllEstimate').val(list);
        //    alert($('#AllEstimate').val());
        //});

        //var idsss = $('.myestimate').find($("input[id^='Index_']")[2]).attr('id');
        //$('#' + idsss).change(function (e) {
        //    list[2] = list[2] + ":" + $('#' + idsss).val();  //每年數量
        //    $('#AllEstimate').val(list);
        //    alert($('#AllEstimate').val());
        //});
    });
</script>